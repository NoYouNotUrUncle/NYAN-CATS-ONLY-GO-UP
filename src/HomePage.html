<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <!-- need this script for lightboxes-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Home</title>
</head>
<style>
    .tab {
        overflow: hidden;
        border: 1px solid #ccc;
        background-color: #f1f1f1;
    }
    .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
    }
    .tabcontent {
        display: none;
        padding: 6px 12px;
        border: 1px solid #ccc;
        border-top: none;
    }
    .tab button.active {
        background-color: #ccc;
    }
    .tab button:hover {
        background-color: #ddd;
    }
</style>
<body>
<nav id="nav"></nav>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>
    $('#nav').load('Navbar.html');
</script>
<br />
<div class="container">
    <h1 id="pageTitle"></h1>
</div>
<div class="container">
    <div class="tab">
        <button class="tablink" onclick="openTab(event, 'trending')" id="defaultOpen">Trending</button>
        <button class="tablink" onclick="openTab(event, 'profile')">Your Profile</button>
    </div>

    <div id="trending" class="tabcontent">
        <a id="trendPage"></a>
    </div>

    <div id="profile" class="tabcontent">
        <a id="profilePage"></a>
    </div>
    <br />
</div>

<script>
    function openTab(evt, tabName) {
        let tabcontent = document.getElementsByClassName("tabcontent");
        for(let i=0; i<tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }

        let tablinks = document.getElementsByClassName("tablink");
        for(let i=0; i<tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " active";

        if(tabName === "trending") {
            loadTrendingPage();
            document.getElementById("pageTitle").innerText = "Trending Memes";
        }
        else {
            loadProfilePage();
            document.getElementById("pageTitle").innerText = "Profile";
        }
    }

    function loadTrendingPage() {
        let trendData = [
            {
                "link": "https://static.boredpanda.com/blog/wp-content/uploads/2021/05/fb_image_60ae515b06705__700.jpg",
                "name": "penguin!!!",
                "description": "super awesome",
                "stats": "sold 42 times",
                "id": "trend1",
                data:[{x:0, y:0.1}, {x:2,y:0.2}, {x:3,y:0.4}, {x:7,y:0.3}, {x:10, y:0.05}],
            },
            {
                "link": "https://i1.wp.com/anitrendz.net/news/wp-content/uploads/2021/04/Winter-2021-Best-Girls.png",
                "name": "best waifus",
                "description": ":)",
                "stats": "sold 69 times",
                "id": "trend2",
                data:[{x:0, y:0.1}, {x:2,y:0.2}, {x:3,y:0.4}, {x:7,y:0.3}, {x:10, y:0.05}],
            },
            {
                "link": "https://i0.wp.com/myotakuworld.com/wp-content/uploads/2020/06/cute-anime-girls-cover-1.jpg?fit=1920%2C1080&ssl=1",
                "name": "quintuplets!!!",
                "description": "5 > 1",
                "stats": "sold 2 times",
                "id": "trend3",
                data:[{x:0, y:0.1}, {x:2,y:0.2}, {x:3,y:0.4}, {x:7,y:0.3}, {x:10, y:0.05}],
            },
            {
                "link": "https://wallpaperboat.com/wp-content/uploads/2020/06/03/42361/aesthetic-anime-01.jpg",
                "name": "scenery!!!",
                "description": "poggers",
                "stats": "sold 1 time",
                "id": "trend4",
                data:[{x:0, y:0.1}, {x:2,y:0.2}, {x:3,y:0.4}, {x:7,y:0.3}, {x:10, y:0.05}],
            },
            {
                "link": "https://wallshub.net/wp-content/uploads/2021/05/Gojo-Satoru-Mobile-Wallpaper.jpg",
                "name": "gojo sensei?",
                "description": "simp",
                "stats": "sold 8 times",
                "id": "trend5",
                data:[{x:0, y:0.1}, {x:2,y:0.2}, {x:3,y:0.4}, {x:7,y:0.3}, {x:10, y:0.05}],
            },
            {
                "link": "https://wallpaper.dog/large/17022708.png",
                "name": "kimi no wa?",
                "description": "saddddddd romance",
                "stats": "sold 6 times",
                "id": "trend6",
                data:[{x:0, y:0.1}, {x:2,y:0.2}, {x:3,y:0.4}, {x:7,y:0.3}, {x:10, y:0.05}],
            },
            {
                "link": "https://media-exp1.licdn.com/dms/image/C4E1BAQHd5EgZUn-Cpw/company-background_10000/0/1605462167150?e=2159024400&v=beta&t=_fwEJRczBjh_1N_ilG3a8zCW29Xn6eFwwmjBzNhw1Go",
                "name": "bayviewwww",
                "description": "lets goooo",
                "stats": "sold 2 times",
                "id": "trend7",
                data:[{x:0, y:0.1}, {x:2,y:0.2}, {x:3,y:0.4}, {x:7,y:0.3}, {x:10, y:0.05}],
            },
        ];

        let memeData = [];
        //App.loadMemes();

        document.getElementById("trendPage").innerHTML = getHTMLGridString(trendData);
        addChartJSRenders(trendData);
    }

    function loadProfilePage() {

    }

    var lastChart = null;

    function addChartJSRenders(data){
        for(let i=0; i<data.length; i++) {
            let meme = data[i];
            $(`#btn_${meme.id}`).on('click', () => {
                let waitForVisibility = setInterval(() => {
                    if ($(`#img_${meme.id}`).width() !== 0) {
                        let ctx = $(`#id_chart_${meme.id}`).get(0).getContext('2d');
                        let imageWidth = $(`#img_${meme.id}`).width();
                        ctx.canvas.width = imageWidth;
                        ctx.canvas.height = imageWidth * (1 / 2);
                        if(lastChart != null){
                            lastChart.destroy();
                        }
                        lastChart = new Chart(ctx, {
                            type: 'scatter',
                            data: {
                                datasets: [{
                                    label: data[i].name,
                                    data: data[i].data,
                                    showLine: true,
                                    fill: false,
                                    borderColor: '#23c895',
                                    tension: 0.3,
                                }]
                            },
                            options: {
                                scales: {
                                    y: {
                                        title: {
                                            display: true,
                                            text: 'Meme Market Cap ($M3M)',
                                        },
                                        beginAtZero: true,
                                    },
                                    x:{
                                        title: {
                                            display: true,
                                            text: 'Time',
                                        }
                                    }
                                }
                            }
                        });
                        clearInterval(waitForVisibility);
                    }
                }, 10);
            })
        }
    }

    function getHTMLGridString(data) {
        let rowCnt = 0;
        let colCnt = 0;

        let colStyles = [ "col-sm-8", "col-sm-4",
            "col-sm", "col-sm", "col-sm",
            "col-6", "col-6",
        ];

        let colLengths = [2, 3, 2];

        let htmlString = "<div class=\"row mt-2\">";
        let htmlModalString = "";

        function createModalHTMLString(meme) {
            return `
                <div class="modal fade" id="${meme.id}" tabindex="-1">
                    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="modalLabel">${meme.name}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body" style="margin-left: auto; margin-right: auto;">
                                <img id="img_${meme.id}" src="${meme.link}" class="img-fluid" alt="">
                                <h5>Information</h5>
                                <p>${meme.stats}</p>
                                <canvas id="id_chart_${meme.id}"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            `
        }

        for(let i=0; i<data.length; i++) {
            htmlModalString += createModalHTMLString(data[i]);
            htmlString +=
            `
                <div class="${colStyles[i % colStyles.length]}">
                    <div class="card">
                        <img src="${data[i].link}" class="img-thumbnail" style="width: 100%; height: 25vw; margin-left: auto; margin-right: auto; object-fit: cover;">
                        <div class="card-body">
                            <h5 class="card-title">${data[i].name}</h5>
                            <p class="card-text">${data[i].description}</p>
                            <button id="btn_${data[i].id}"  class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#${data[i].id}">View</button>
                        </div>
                    </div>
                </div>
            `
            colCnt++;

            if(colCnt === colLengths[rowCnt % colLengths.length]) {
                colCnt = 0;
                rowCnt++;
                htmlString += "</div>"; // close the row
                if(i !== data.length-1) { // if this isn't the last item
                    htmlString += "<div class=\"row mt-2\">" // should create more rows
                }
            }
        }
        htmlString += htmlModalString;
        return htmlString;
    }

    document.getElementById("defaultOpen").click();
</script>

<script src="js/web3.min.js"></script>
<script src="js/truffle-contract.js"></script>
<script src="js/app.js"></script>

</body>


</html>